###
# Claude Code Integration Examples
#
# These examples demonstrate how Claude Code (Anthropic's coding assistant)
# interacts with Sibyl backend via the OpenAI-compatible facade.
#
# Prerequisites:
# - Sibyl server running on http://localhost:8000
# - Workspace configured with routing profiles
# - Environment variables set:
#   export CLAUDE_API_URL=http://localhost:8000/v1
#   export CLAUDE_API_KEY=sibyl_key
#   export CLAUDE_MODEL=sibyl/code-balanced
#
# Usage with VS Code REST Client extension:
# 1. Install "REST Client" extension
# 2. Open this file
# 3. Click "Send Request" above each request
###

@baseUrl = http://localhost:8000/v1
@apiKey = sibyl_key

###
# Example 1: Simple Code Question (Fast Profile)
# Command: claude-code "How do I read a CSV file in Python?"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-fast",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "How do I read a CSV file in Python?"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 1500
}

###
# Example 2: Code Explanation (Balanced Profile)
# Command: claude-code "Explain this code" < src/utils.py

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-balanced",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Explain what this code does:\n\nasync def fetch_data(session, url):\n    async with session.get(url) as response:\n        if response.status == 200:\n            return await response.json()\n        else:\n            raise Exception(f'HTTP {response.status}')"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 2000
}

###
# Example 3: Code Generation (Balanced Profile)
# Command: claude-code "Generate a Pydantic model for a Product"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-balanced",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Generate a Pydantic model for a Product with fields: id (UUID), name (str), price (Decimal), description (optional str), created_at (datetime), tags (list of strings)"
    }
  ],
  "temperature": 0.5,
  "max_tokens": 1000
}

###
# Example 4: Debugging Help (Balanced Profile)
# Command: claude-code "Why am I getting a KeyError?"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-balanced",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "I'm getting a KeyError: 'username'. Here's my code:\n\nuser_data = {'name': 'John', 'email': 'john@example.com'}\nusername = user_data['username']\nprint(username)\n\nWhat's wrong and how do I fix it?"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 1500
}

###
# Example 5: Architecture Design (Think Profile)
# Command: claude-code "Design a microservices architecture"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-think",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Design a microservices architecture for a real-time chat application with the following requirements:\n- Support for 1M+ concurrent users\n- Message persistence\n- Presence tracking (online/offline status)\n- File sharing\n- End-to-end encryption\n\nInclude service boundaries, data stores, message queues, and scaling strategies."
    }
  ],
  "temperature": 0.7,
  "max_tokens": 3000
}

###
# Example 6: Refactoring (Balanced Profile)
# Command: claude-code "Refactor this function to use async/await"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-balanced",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Refactor this function to use async/await and proper error handling:\n\ndef fetch_user_data(user_ids):\n    results = []\n    for user_id in user_ids:\n        response = requests.get(f'https://api.example.com/users/{user_id}')\n        results.append(response.json())\n    return results"
    }
  ],
  "temperature": 0.6,
  "max_tokens": 1500
}

###
# Example 7: Multi-Turn Conversation
# Command: Interactive mode with conversation history

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-balanced",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "How do I create a REST API with FastAPI?"
    },
    {
      "role": "assistant",
      "content": "Here's a basic FastAPI REST API:\n\n```python\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n@app.get(\"/\")\ndef read_root():\n    return {\"message\": \"Hello World\"}\n\n@app.get(\"/items/{item_id}\")\ndef read_item(item_id: int):\n    return {\"item_id\": item_id}\n```"
    },
    {
      "role": "user",
      "content": "Now add POST endpoint with Pydantic validation"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 2000
}

###
# Example 8: Test Generation (Balanced Profile)
# Command: claude-code "Generate pytest tests for this function"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-balanced",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Generate comprehensive pytest unit tests for this function:\n\ndef validate_email(email: str) -> bool:\n    import re\n    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$'\n    return bool(re.match(pattern, email))"
    }
  ],
  "temperature": 0.5,
  "max_tokens": 1500
}

###
# Example 9: Code Review (Think Profile)
# Command: claude-code "Review this code for security issues"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-think",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant specialized in security."
    },
    {
      "role": "user",
      "content": "Review this code for security vulnerabilities:\n\n@app.post('/login')\ndef login(username: str, password: str):\n    query = f\"SELECT * FROM users WHERE username='{username}' AND password='{password}'\"\n    cursor.execute(query)\n    user = cursor.fetchone()\n    if user:\n        session['user_id'] = user[0]\n        return {'status': 'success'}\n    return {'status': 'failed'}"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 2000
}

###
# Example 10: Context-Aware Request with Metadata
# Scenario: Claude Code passes workspace context

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-balanced",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Show me all API endpoints in this FastAPI project"
    }
  ],
  "metadata": {
    "workspace": "/Users/dev/myproject",
    "project_context": {
      "framework": "fastapi",
      "language": "python",
      "version": "3.11"
    }
  }
}

###
# Example 11: Documentation Generation
# Command: claude-code "Add docstrings to this class"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-fast",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Add comprehensive Google-style docstrings to this class:\n\nclass DataProcessor:\n    def __init__(self, config):\n        self.config = config\n        self.cache = {}\n    \n    def process(self, data):\n        if data.id in self.cache:\n            return self.cache[data.id]\n        result = self._transform(data)\n        self.cache[data.id] = result\n        return result\n    \n    def _transform(self, data):\n        return data.value * self.config.multiplier"
    }
  ],
  "temperature": 0.4,
  "max_tokens": 1500
}

###
# Example 12: Type Hints Addition
# Command: claude-code "Add type hints to this code"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-fast",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Add proper type hints to this code:\n\ndef fetch_users(ids, include_details=False):\n    results = []\n    for user_id in ids:\n        user = get_user(user_id)\n        if user:\n            if include_details:\n                user['details'] = get_user_details(user_id)\n            results.append(user)\n    return results"
    }
  ],
  "temperature": 0.3,
  "max_tokens": 1000
}

###
# Example 13: Performance Optimization
# Command: claude-code "Optimize this code for performance"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-think",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Optimize this code for better performance. Explain the improvements:\n\ndef find_common_elements(list1, list2):\n    common = []\n    for item1 in list1:\n        for item2 in list2:\n            if item1 == item2 and item1 not in common:\n                common.append(item1)\n    return common"
    }
  ],
  "temperature": 0.6,
  "max_tokens": 2000
}

###
# Example 14: Error Handling Enhancement
# Command: claude-code "Add error handling to this code"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-balanced",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Add comprehensive error handling with logging to this code:\n\nasync def process_order(order_id):\n    order = await db.get_order(order_id)\n    payment = await payment_service.charge(order.total)\n    inventory = await inventory_service.reserve(order.items)\n    await notification_service.send(order.user_id, 'Order processed')\n    return {'status': 'success'}"
    }
  ],
  "temperature": 0.6,
  "max_tokens": 2000
}

###
# Example 15: Code Translation
# Command: claude-code "Translate this Python code to TypeScript"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-balanced",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Translate this Python code to TypeScript:\n\nfrom typing import List, Optional\n\nclass User:\n    def __init__(self, id: int, name: str, email: str):\n        self.id = id\n        self.name = name\n        self.email = email\n        self.active = True\n    \n    def deactivate(self) -> None:\n        self.active = False\n    \n    @staticmethod\n    def find_by_email(users: List['User'], email: str) -> Optional['User']:\n        return next((u for u in users if u.email == email), None)"
    }
  ],
  "temperature": 0.5,
  "max_tokens": 1500
}

###
# Example 16: Pipeline-Specific Request
# Scenario: Use specific Sibyl pipeline (refactoring)

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-balanced",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Refactor this code to use dependency injection:\n\nclass UserService:\n    def __init__(self):\n        self.db = Database('postgresql://localhost/mydb')\n        self.cache = Redis('localhost:6379')\n        self.logger = Logger('userservice.log')\n    \n    def get_user(self, user_id):\n        cached = self.cache.get(f'user:{user_id}')\n        if cached:\n            return cached\n        user = self.db.query('SELECT * FROM users WHERE id = ?', user_id)\n        self.cache.set(f'user:{user_id}', user)\n        return user"
    }
  ],
  "metadata": {
    "pipeline": "code_refactor"
  }
}

###
# Example 17: Streaming Response
# Scenario: Claude Code displays response in real-time

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-balanced",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Explain how to implement a Redis-based rate limiter in Python with code examples"
    }
  ],
  "stream": true,
  "temperature": 0.7,
  "max_tokens": 2000
}

###
# Example 18: Complex Reasoning (Think Profile)
# Command: claude-code "Design a distributed caching strategy"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-think",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Design a distributed caching strategy for a high-traffic e-commerce site with the following requirements:\n- Handle 100K requests per second\n- Cache product data, user sessions, and cart information\n- Support cache invalidation on inventory updates\n- Minimize cache stampede\n- Multi-region deployment\n- Maintain consistency across regions\n\nInclude specific technologies, caching layers, and invalidation strategies."
    }
  ],
  "temperature": 0.7,
  "max_tokens": 3000
}

###
# Example 19: SQL Query Generation
# Command: claude-code "Generate a SQL query for this requirement"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-balanced",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Generate a SQL query that:\n1. Joins users, orders, and order_items tables\n2. Filters for orders placed in the last 30 days\n3. Groups by user\n4. Shows user email, total orders, and total spent\n5. Orders by total spent descending\n6. Returns top 100 users"
    }
  ],
  "temperature": 0.4,
  "max_tokens": 1000
}

###
# Example 20: API Design
# Command: claude-code "Design REST API endpoints for this feature"

POST {{baseUrl}}/chat/completions
Content-Type: application/json
Authorization: Bearer {{apiKey}}

{
  "model": "sibyl/code-think",
  "messages": [
    {
      "role": "system",
      "content": "You are Claude, a helpful AI assistant."
    },
    {
      "role": "user",
      "content": "Design REST API endpoints for a task management system with the following features:\n- Create, read, update, delete tasks\n- Assign tasks to users\n- Add comments to tasks\n- Track task status (todo, in_progress, done)\n- Filter tasks by status, assignee, due date\n- Bulk operations\n\nInclude HTTP methods, URL patterns, request/response schemas, and error codes."
    }
  ],
  "temperature": 0.7,
  "max_tokens": 2500
}

###
# Health Check
# Verify Sibyl server is running

GET http://localhost:8000/health
Content-Type: application/json

###
# List Available Models
# Check available routing profiles

GET {{baseUrl}}/models
Content-Type: application/json
Authorization: Bearer {{apiKey}}
