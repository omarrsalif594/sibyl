technique: session_management
description: "Session lifecycle and context management with pluggable rotation strategies"
version: "1.0.0"

# Default subtechniques to use for each category
defaults:
  rotation_strategy: token_based
  rotation_based: rotation_manager
  context_preservation: sliding_window
  summarization: extractive

# Global settings
enabled: true
timeout_seconds: 300
max_retries: 3

# Rotation strategy configuration
rotation_strategy:
  token_based:
    summarize_threshold_pct: 60.0
    rotate_threshold_pct: 70.0
    model_adaptive: true
    user_overrides: {}

  time_based:
    max_duration_seconds: 3600  # 1 hour
    max_duration_minutes: null
    max_duration_hours: null

  message_count:
    max_message_count: 50
    warning_threshold_pct: 80.0

# Rotation-based configuration (integrates rotation + circuit breaker)
rotation_based:
  rotation_manager:
    # Session rotation settings
    rotation:
      operation_poll_ms: 100
      status_log_interval_seconds: 5
      early_rotation_threshold: 0.60
      force_rotation_threshold: 0.70
      rotation_timeout_seconds: 30

    # Circuit breaker settings
    circuit_breaker:
      failure_threshold: 3
      recovery_timeout_seconds: 30
      half_open_max_calls: 1

    # Session defaults
    session_defaults:
      default_tokens_budget: 200000
      default_model_name: "claude-sonnet-4.5"
      enable_generation_counter: true
      enable_operation_tracking: true

    # Observability
    observability:
      log_rotation_events: true
      log_circuit_breaker_events: true
      emit_metrics: true
      enable_tracing: false

    # Environment variable overrides
    env_overrides_enabled: true

# Context preservation configuration
context_preservation:
  sliding_window:
    window_size: 10
    preserve_system_messages: true

  importance_based:
    top_k: 15
    importance_threshold: 0.5
    always_keep_first: true
    always_keep_last: true
    scoring:
      role_weights:
        system: 1.0
        user: 0.7
        assistant: 0.6
      feature_weights:
        has_code: 1.5
        has_question: 1.3
        has_error: 1.4
        length_factor: 0.3
        recency_factor: 0.5

  full_history:
    warning_threshold: 100
    hard_limit: 1000

# Summarization configuration
summarization:
  extractive:
    target_ratio: 0.3
    min_sentences: 3
    max_sentences: 50
    scoring:
      tf_weight: 1.0
      position_weight: 0.5
      keyword_weight: 0.8
      code_weight: 1.5
      question_weight: 1.2

  abstractive:
    model: "claude-haiku-4"
    provider: "anthropic"
    timeout_seconds: 30
    max_summary_tokens: 1000
    fallback_to_extractive: true
    temperature: 0.3

  no_summarize:
    pass_through: true
    add_metadata: false
